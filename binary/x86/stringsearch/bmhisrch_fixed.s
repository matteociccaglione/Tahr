	.text
	.globl	bmhi_init
bmhi_init:
	daddiu	$sp,$sp,-64
	sd	$ra,56($sp)
	sd	$fp,48($sp)
	sd	$s0,40($sp)
	move	$fp,$sp
	sd	$a0,16($fp)
	ld	$a0,16($fp)
	balc	strlen
	sll	$v0,$v0,0
	move	$v1,$v0
	lui	$v0,%highest(patlen)
	daddiu	$v0,$v0,%higher(patlen)
	dsll	$v0,$v0,16
	daddiu	$v0,$v0,%hi(patlen)
	dsll	$v0,$v0,16
	sw	$v1,%lo(patlen)($v0)
	lui	$v0,%highest(pat)
	daddiu	$v0,$v0,%higher(pat)
	dsll	$v0,$v0,16
	daddiu	$v0,$v0,%hi(pat)
	dsll	$v0,$v0,16
	ld	$v1,%lo(pat)($v0)
	lui	$v0,%highest(patlen)
	daddiu	$v0,$v0,%higher(patlen)
	dsll	$v0,$v0,16
	daddiu	$v0,$v0,%hi(patlen)
	dsll	$v0,$v0,16
	lw	$v0,%lo(patlen)($v0)
	move	$a1,$v0
	move	$a0,$v1
	balc	realloc
	move	$v1,$v0
	lui	$v0,%highest(pat)
	daddiu	$v0,$v0,%higher(pat)
	dsll	$v0,$v0,16
	daddiu	$v0,$v0,%hi(pat)
	dsll	$v0,$v0,16
	sd	$v1,%lo(pat)($v0)
	lui	$v0,%highest(pat)
	daddiu	$v0,$v0,%higher(pat)
	dsll	$v0,$v0,16
	daddiu	$v0,$v0,%hi(pat)
	dsll	$v0,$v0,16
	ld	$v0,%lo(pat)($v0)
	bnezc	$v0,.L2
	li	$a0,1			
	balc	exit
.L2:
	lui	$v0,%highest(bhmi_cleanup)
	daddiu	$v0,$v0,%higher(bhmi_cleanup)
	dsll	$v0,$v0,16
	daddiu	$v0,$v0,%hi(bhmi_cleanup)
	dsll	$v0,$v0,16
	daddiu	$a0,$v0,%lo(bhmi_cleanup)
	balc	atexit
	sw	$zero,0($fp)
	bc	.L3
.L4:
	lw	$v0,0($fp)
	ld	$v1,16($fp)
	daddu	$v0,$v1,$v0
	lb	$v0,0($v0)
	move	$a0,$v0
	balc	toupper
	move	$a0,$v0
	lui	$v0,%highest(pat)
	daddiu	$v0,$v0,%higher(pat)
	dsll	$v0,$v0,16
	daddiu	$v0,$v0,%hi(pat)
	dsll	$v0,$v0,16
	ld	$v1,%lo(pat)($v0)
	lw	$v0,0($fp)
	daddu	$v0,$v1,$v0
	andi	$v1,$a0,0x00ff
	sb	$v1,0($v0)
	lw	$v0,0($fp)
	addiu	$v0,$v0,1
	sw	$v0,0($fp)
.L3:
	lui	$v0,%highest(patlen)
	daddiu	$v0,$v0,%higher(patlen)
	dsll	$v0,$v0,16
	daddiu	$v0,$v0,%hi(patlen)
	dsll	$v0,$v0,16
	lw	$v1,%lo(patlen)($v0)
	lw	$v0,0($fp)
	bltc	$v0,$v1,.L4
	sw	$zero,0($fp)
	bc	.L5
.L6:
	lui	$v0,%highest(patlen)
	daddiu	$v0,$v0,%higher(patlen)
	dsll	$v0,$v0,16
	daddiu	$v0,$v0,%hi(patlen)
	dsll	$v0,$v0,16
	lw	$v1,%lo(patlen)($v0)
	lui	$v0,%highest(skip)
	daddiu	$v0,$v0,%higher(skip)
	dsll	$v0,$v0,16
	daddiu	$v0,$v0,%hi(skip)
	dsll	$v0,$v0,16
	daddiu	$v0,$v0,%lo(skip)
	lw	$a0,0($fp)
	dsll	$a0,$a0,2
	daddu	$v0,$a0,$v0
	sw	$v1,0($v0)
	lw	$v0,0($fp)
	addiu	$v0,$v0,1
	sw	$v0,0($fp)
.L5:
	lw	$v0,0($fp)
	li	$v1,255			
	bgec	$v1,$v0,.L6
	sw	$zero,0($fp)
	bc	.L7
.L8:
	lui	$v0,%highest(patlen)
	daddiu	$v0,$v0,%higher(patlen)
	dsll	$v0,$v0,16
	daddiu	$v0,$v0,%hi(patlen)
	dsll	$v0,$v0,16
	lw	$v1,%lo(patlen)($v0)
	lw	$v0,0($fp)
	subu	$v0,$v1,$v0
	lui	$v1,%highest(pat)
	daddiu	$v1,$v1,%higher(pat)
	dsll	$v1,$v1,16
	daddiu	$v1,$v1,%hi(pat)
	dsll	$v1,$v1,16
	ld	$a0,%lo(pat)($v1)
	lw	$v1,0($fp)
	daddu	$v1,$a0,$v1
	lbu	$v1,0($v1)
	move	$a0,$v1
	addiu	$v0,$v0,-1
	move	$v1,$v0
	lui	$v0,%highest(skip)
	daddiu	$v0,$v0,%higher(skip)
	dsll	$v0,$v0,16
	daddiu	$v0,$v0,%hi(skip)
	dsll	$v0,$v0,16
	daddiu	$v0,$v0,%lo(skip)
	dsll	$a0,$a0,2
	daddu	$v0,$a0,$v0
	sw	$v1,0($v0)
	lui	$v0,%highest(patlen)
	daddiu	$v0,$v0,%higher(patlen)
	dsll	$v0,$v0,16
	daddiu	$v0,$v0,%hi(patlen)
	dsll	$v0,$v0,16
	lw	$v1,%lo(patlen)($v0)
	lw	$v0,0($fp)
	subu	$v0,$v1,$v0
	move	$s0,$v0
	lui	$v0,%highest(pat)
	daddiu	$v0,$v0,%higher(pat)
	dsll	$v0,$v0,16
	daddiu	$v0,$v0,%hi(pat)
	dsll	$v0,$v0,16
	ld	$v1,%lo(pat)($v0)
	lw	$v0,0($fp)
	daddu	$v0,$v1,$v0
	lbu	$v0,0($v0)
	move	$a0,$v0
	balc	tolower
	move	$a0,$v0
	addiu	$v0,$s0,-1
	move	$v1,$v0
	lui	$v0,%highest(skip)
	daddiu	$v0,$v0,%higher(skip)
	dsll	$v0,$v0,16
	daddiu	$v0,$v0,%hi(skip)
	dsll	$v0,$v0,16
	daddiu	$v0,$v0,%lo(skip)
	dsll	$a0,$a0,2
	daddu	$v0,$a0,$v0
	sw	$v1,0($v0)
	lw	$v0,0($fp)
	addiu	$v0,$v0,1
	sw	$v0,0($fp)
.L7:
	lui	$v0,%highest(patlen)
	daddiu	$v0,$v0,%higher(patlen)
	dsll	$v0,$v0,16
	daddiu	$v0,$v0,%hi(patlen)
	dsll	$v0,$v0,16
	lw	$v0,%lo(patlen)($v0)
	addiu	$v0,$v0,-1
	move	$v1,$v0
	lw	$v0,0($fp)
	bltc	$v0,$v1,.L8
	lui	$v0,%highest(pat)
	daddiu	$v0,$v0,%higher(pat)
	dsll	$v0,$v0,16
	daddiu	$v0,$v0,%hi(pat)
	dsll	$v0,$v0,16
	ld	$v1,%lo(pat)($v0)
	lui	$v0,%highest(patlen)
	daddiu	$v0,$v0,%higher(patlen)
	dsll	$v0,$v0,16
	daddiu	$v0,$v0,%hi(patlen)
	dsll	$v0,$v0,16
	lw	$v0,%lo(patlen)($v0)
	daddiu	$v0,$v0,-1
	daddu	$v0,$v1,$v0
	lbu	$v0,0($v0)
	sw	$v0,4($fp)
	lui	$v0,%highest(skip)
	daddiu	$v0,$v0,%higher(skip)
	dsll	$v0,$v0,16
	daddiu	$v0,$v0,%hi(skip)
	dsll	$v0,$v0,16
	daddiu	$v0,$v0,%lo(skip)
	lw	$v1,4($fp)
	dsll	$v1,$v1,2
	daddu	$v0,$v1,$v0
	li	$v1,32767			
	sw	$v1,0($v0)
	lw	$v0,4($fp)
	move	$a0,$v0
	balc	tolower
	move	$v1,$v0
	lui	$v0,%highest(skip)
	daddiu	$v0,$v0,%higher(skip)
	dsll	$v0,$v0,16
	daddiu	$v0,$v0,%hi(skip)
	dsll	$v0,$v0,16
	daddiu	$v0,$v0,%lo(skip)
	dsll	$v1,$v1,2
	daddu	$v0,$v1,$v0
	li	$v1,32767			
	sw	$v1,0($v0)
	lui	$v0,%highest(patlen)
	daddiu	$v0,$v0,%higher(patlen)
	dsll	$v0,$v0,16
	daddiu	$v0,$v0,%hi(patlen)
	dsll	$v0,$v0,16
	lw	$v1,%lo(patlen)($v0)
	lui	$v0,%highest(skip2)
	daddiu	$v0,$v0,%higher(skip2)
	dsll	$v0,$v0,16
	daddiu	$v0,$v0,%hi(skip2)
	dsll	$v0,$v0,16
	sw	$v1,%lo(skip2)($v0)
	sw	$zero,0($fp)
	bc	.L9
.L11:
	lui	$v0,%highest(pat)
	daddiu	$v0,$v0,%higher(pat)
	dsll	$v0,$v0,16
	daddiu	$v0,$v0,%hi(pat)
	dsll	$v0,$v0,16
	ld	$v1,%lo(pat)($v0)
	lw	$v0,0($fp)
	daddu	$v0,$v1,$v0
	lbu	$v0,0($v0)
	move	$v1,$v0
	lw	$v0,4($fp)
	bnec	$v0,$v1,.L10
	lui	$v0,%highest(patlen)
	daddiu	$v0,$v0,%higher(patlen)
	dsll	$v0,$v0,16
	daddiu	$v0,$v0,%hi(patlen)
	dsll	$v0,$v0,16
	lw	$v1,%lo(patlen)($v0)
	lw	$v0,0($fp)
	subu	$v0,$v1,$v0
	addiu	$v0,$v0,-1
	move	$v1,$v0
	lui	$v0,%highest(skip2)
	daddiu	$v0,$v0,%higher(skip2)
	dsll	$v0,$v0,16
	daddiu	$v0,$v0,%hi(skip2)
	dsll	$v0,$v0,16
	sw	$v1,%lo(skip2)($v0)
.L10:
	lw	$v0,0($fp)
	addiu	$v0,$v0,1
	sw	$v0,0($fp)
.L9:
	lui	$v0,%highest(patlen)
	daddiu	$v0,$v0,%higher(patlen)
	dsll	$v0,$v0,16
	daddiu	$v0,$v0,%hi(patlen)
	dsll	$v0,$v0,16
	lw	$v0,%lo(patlen)($v0)
	addiu	$v0,$v0,-1
	move	$v1,$v0
	lw	$v0,0($fp)
	bltc	$v0,$v1,.L11
	nop
	nop
	move	$sp,$fp
	ld	$ra,56($sp)
	ld	$fp,48($sp)
	ld	$s0,40($sp)
	daddiu	$sp,$sp,64
	jrc	$ra
	.globl	bmhi_search
bmhi_search:
	daddiu	$sp,$sp,-48
	sd	$ra,40($sp)
	sd	$fp,32($sp)
	move	$fp,$sp
	sd	$a0,16($fp)
	move	$v0,$a1
	sll	$v0,$v0,0
	sw	$v0,24($fp)
	lui	$v0,%highest(patlen)
	daddiu	$v0,$v0,%higher(patlen)
	dsll	$v0,$v0,16
	daddiu	$v0,$v0,%hi(patlen)
	dsll	$v0,$v0,16
	lw	$v0,%lo(patlen)($v0)
	addiu	$v0,$v0,-1
	move	$v1,$v0
	lw	$v0,24($fp)
	subu	$v0,$v1,$v0
	sw	$v0,0($fp)
	lw	$v0,0($fp)
	bltzc	$v0,.L13
	move	$v0,$zero
	bc	.L14
.L13:
	lw	$v0,24($fp)
	ld	$v1,16($fp)
	daddu	$v0,$v1,$v0
	sd	$v0,16($fp)
.L21:
	nop
.L15:
	lw	$v0,0($fp)
	ld	$v1,16($fp)
	daddu	$v0,$v1,$v0
	lbu	$v0,0($v0)
	move	$v1,$v0
	lui	$v0,%highest(skip)
	daddiu	$v0,$v0,%higher(skip)
	dsll	$v0,$v0,16
	daddiu	$v0,$v0,%hi(skip)
	dsll	$v0,$v0,16
	daddiu	$v0,$v0,%lo(skip)
	dsll	$v1,$v1,2
	daddu	$v0,$v1,$v0
	lw	$v0,0($v0)
	lw	$v1,0($fp)
	addu	$v0,$v1,$v0
	sw	$v0,0($fp)
	lw	$v0,0($fp)
	bltzc	$v0,.L15
	li	$v1,32767			
	lw	$v0,24($fp)
	subu	$v0,$v1,$v0
	move	$v1,$v0
	lw	$v0,0($fp)
	bgec	$v0,$v1,.L16
	move	$v0,$zero
	bc	.L14
.L16:
	lw	$v0,0($fp)
	addiu	$v0,$v0,-32767
	sw	$v0,0($fp)
	lui	$v0,%highest(patlen)
	daddiu	$v0,$v0,%higher(patlen)
	dsll	$v0,$v0,16
	daddiu	$v0,$v0,%hi(patlen)
	dsll	$v0,$v0,16
	lw	$v0,%lo(patlen)($v0)
	addiu	$v0,$v0,-1
	sw	$v0,4($fp)
	lw	$v1,0($fp)
	lw	$v0,4($fp)
	subu	$v0,$v1,$v0
	move	$v1,$v0
	ld	$v0,16($fp)
	daddu	$v0,$v0,$v1
	sd	$v0,8($fp)
	nop
.L18:
	lw	$v0,4($fp)
	addiu	$v0,$v0,-1
	sw	$v0,4($fp)
	lw	$v0,4($fp)
	bltzc	$v0,.L17
	lw	$v0,4($fp)
	ld	$v1,8($fp)
	daddu	$v0,$v1,$v0
	lb	$v0,0($v0)
	move	$a0,$v0
	balc	toupper
	move	$a0,$v0
	lui	$v0,%highest(pat)
	daddiu	$v0,$v0,%higher(pat)
	dsll	$v0,$v0,16
	daddiu	$v0,$v0,%hi(pat)
	dsll	$v0,$v0,16
	ld	$v1,%lo(pat)($v0)
	lw	$v0,4($fp)
	daddu	$v0,$v1,$v0
	lbu	$v0,0($v0)
	beqc	$a0,$v0,.L18
.L17:
	lw	$v0,4($fp)
	bgezc	$v0,.L19
	ld	$v0,8($fp)
	bc	.L14
.L19:
	lui	$v0,%highest(skip2)
	daddiu	$v0,$v0,%higher(skip2)
	dsll	$v0,$v0,16
	daddiu	$v0,$v0,%hi(skip2)
	dsll	$v0,$v0,16
	lw	$v0,%lo(skip2)($v0)
	lw	$v1,0($fp)
	addu	$v0,$v1,$v0
	sw	$v0,0($fp)
	lw	$v0,0($fp)
	bltzc	$v0,.L21
	move	$v0,$zero
.L14:
	move	$sp,$fp
	ld	$ra,40($sp)
	ld	$fp,32($sp)
	daddiu	$sp,$sp,48
	jrc	$ra
	.globl	bhmi_cleanup
bhmi_cleanup:
	daddiu	$sp,$sp,-16
	sd	$ra,8($sp)
	sd	$fp,0($sp)
	move	$fp,$sp
	lui	$v0,%highest(pat)
	daddiu	$v0,$v0,%higher(pat)
	dsll	$v0,$v0,16
	daddiu	$v0,$v0,%hi(pat)
	dsll	$v0,$v0,16
	ld	$v0,%lo(pat)($v0)
	move	$a0,$v0
	balc	free
	nop
	move	$sp,$fp
	ld	$ra,8($sp)
	ld	$fp,0($sp)
	daddiu	$sp,$sp,16
	jrc	$ra
