	.text
	.globl	bmhi_init
bmhi_init:
	daddiu	$sp,$sp,-64
	sd	$31,56($sp)
	sd	$fp,48($sp)
	sd	$16,40($sp)
	move	$fp,$sp
	sd	$4,16($fp)
	ld	$4,16($fp)
	balc	strlen
	sll	$2,$2,0
	move	$3,$2
	lui	$2,%highest(patlen)
	daddiu	$2,$2,%higher(patlen)
	dsll	$2,$2,16
	daddiu	$2,$2,%hi(patlen)
	dsll	$2,$2,16
	sw	$3,%lo(patlen)($2)
	lui	$2,%highest(pat)
	daddiu	$2,$2,%higher(pat)
	dsll	$2,$2,16
	daddiu	$2,$2,%hi(pat)
	dsll	$2,$2,16
	ld	$3,%lo(pat)($2)
	lui	$2,%highest(patlen)
	daddiu	$2,$2,%higher(patlen)
	dsll	$2,$2,16
	daddiu	$2,$2,%hi(patlen)
	dsll	$2,$2,16
	lw	$2,%lo(patlen)($2)
	move	$5,$2
	move	$4,$3
	balc	realloc
	move	$3,$2
	lui	$2,%highest(pat)
	daddiu	$2,$2,%higher(pat)
	dsll	$2,$2,16
	daddiu	$2,$2,%hi(pat)
	dsll	$2,$2,16
	sd	$3,%lo(pat)($2)
	lui	$2,%highest(pat)
	daddiu	$2,$2,%higher(pat)
	dsll	$2,$2,16
	daddiu	$2,$2,%hi(pat)
	dsll	$2,$2,16
	ld	$2,%lo(pat)($2)
	bnezc	$2,.L2
	li	$4,1			
	balc	exit
.L2:
	lui	$2,%highest(bhmi_cleanup)
	daddiu	$2,$2,%higher(bhmi_cleanup)
	dsll	$2,$2,16
	daddiu	$2,$2,%hi(bhmi_cleanup)
	dsll	$2,$2,16
	daddiu	$4,$2,%lo(bhmi_cleanup)
	balc	atexit
	sw	$0,0($fp)
	bc	.L3
.L4:
	lw	$2,0($fp)
	ld	$3,16($fp)
	daddu	$2,$3,$2
	lb	$2,0($2)
	move	$4,$2
	balc	toupper
	move	$4,$2
	lui	$2,%highest(pat)
	daddiu	$2,$2,%higher(pat)
	dsll	$2,$2,16
	daddiu	$2,$2,%hi(pat)
	dsll	$2,$2,16
	ld	$3,%lo(pat)($2)
	lw	$2,0($fp)
	daddu	$2,$3,$2
	andi	$3,$4,0x00ff
	sb	$3,0($2)
	lw	$2,0($fp)
	addiu	$2,$2,1
	sw	$2,0($fp)
.L3:
	lui	$2,%highest(patlen)
	daddiu	$2,$2,%higher(patlen)
	dsll	$2,$2,16
	daddiu	$2,$2,%hi(patlen)
	dsll	$2,$2,16
	lw	$3,%lo(patlen)($2)
	lw	$2,0($fp)
	bltc	$2,$3,.L4
	sw	$0,0($fp)
	bc	.L5
.L6:
	lui	$2,%highest(patlen)
	daddiu	$2,$2,%higher(patlen)
	dsll	$2,$2,16
	daddiu	$2,$2,%hi(patlen)
	dsll	$2,$2,16
	lw	$3,%lo(patlen)($2)
	lui	$2,%highest(skip)
	daddiu	$2,$2,%higher(skip)
	dsll	$2,$2,16
	daddiu	$2,$2,%hi(skip)
	dsll	$2,$2,16
	daddiu	$2,$2,%lo(skip)
	lw	$4,0($fp)
	dsll	$4,$4,2
	daddu	$2,$4,$2
	sw	$3,0($2)
	lw	$2,0($fp)
	addiu	$2,$2,1
	sw	$2,0($fp)
.L5:
	lw	$2,0($fp)
	li	$3,255			
	bgec	$3,$2,.L6
	sw	$0,0($fp)
	bc	.L7
.L8:
	lui	$2,%highest(patlen)
	daddiu	$2,$2,%higher(patlen)
	dsll	$2,$2,16
	daddiu	$2,$2,%hi(patlen)
	dsll	$2,$2,16
	lw	$3,%lo(patlen)($2)
	lw	$2,0($fp)
	subu	$2,$3,$2
	lui	$3,%highest(pat)
	daddiu	$3,$3,%higher(pat)
	dsll	$3,$3,16
	daddiu	$3,$3,%hi(pat)
	dsll	$3,$3,16
	ld	$4,%lo(pat)($3)
	lw	$3,0($fp)
	daddu	$3,$4,$3
	lbu	$3,0($3)
	move	$4,$3
	addiu	$2,$2,-1
	move	$3,$2
	lui	$2,%highest(skip)
	daddiu	$2,$2,%higher(skip)
	dsll	$2,$2,16
	daddiu	$2,$2,%hi(skip)
	dsll	$2,$2,16
	daddiu	$2,$2,%lo(skip)
	dsll	$4,$4,2
	daddu	$2,$4,$2
	sw	$3,0($2)
	lui	$2,%highest(patlen)
	daddiu	$2,$2,%higher(patlen)
	dsll	$2,$2,16
	daddiu	$2,$2,%hi(patlen)
	dsll	$2,$2,16
	lw	$3,%lo(patlen)($2)
	lw	$2,0($fp)
	subu	$2,$3,$2
	move	$16,$2
	lui	$2,%highest(pat)
	daddiu	$2,$2,%higher(pat)
	dsll	$2,$2,16
	daddiu	$2,$2,%hi(pat)
	dsll	$2,$2,16
	ld	$3,%lo(pat)($2)
	lw	$2,0($fp)
	daddu	$2,$3,$2
	lbu	$2,0($2)
	move	$4,$2
	balc	tolower
	move	$4,$2
	addiu	$2,$16,-1
	move	$3,$2
	lui	$2,%highest(skip)
	daddiu	$2,$2,%higher(skip)
	dsll	$2,$2,16
	daddiu	$2,$2,%hi(skip)
	dsll	$2,$2,16
	daddiu	$2,$2,%lo(skip)
	dsll	$4,$4,2
	daddu	$2,$4,$2
	sw	$3,0($2)
	lw	$2,0($fp)
	addiu	$2,$2,1
	sw	$2,0($fp)
.L7:
	lui	$2,%highest(patlen)
	daddiu	$2,$2,%higher(patlen)
	dsll	$2,$2,16
	daddiu	$2,$2,%hi(patlen)
	dsll	$2,$2,16
	lw	$2,%lo(patlen)($2)
	addiu	$2,$2,-1
	move	$3,$2
	lw	$2,0($fp)
	bltc	$2,$3,.L8
	lui	$2,%highest(pat)
	daddiu	$2,$2,%higher(pat)
	dsll	$2,$2,16
	daddiu	$2,$2,%hi(pat)
	dsll	$2,$2,16
	ld	$3,%lo(pat)($2)
	lui	$2,%highest(patlen)
	daddiu	$2,$2,%higher(patlen)
	dsll	$2,$2,16
	daddiu	$2,$2,%hi(patlen)
	dsll	$2,$2,16
	lw	$2,%lo(patlen)($2)
	daddiu	$2,$2,-1
	daddu	$2,$3,$2
	lbu	$2,0($2)
	sw	$2,4($fp)
	lui	$2,%highest(skip)
	daddiu	$2,$2,%higher(skip)
	dsll	$2,$2,16
	daddiu	$2,$2,%hi(skip)
	dsll	$2,$2,16
	daddiu	$2,$2,%lo(skip)
	lw	$3,4($fp)
	dsll	$3,$3,2
	daddu	$2,$3,$2
	li	$3,32767			
	sw	$3,0($2)
	lw	$2,4($fp)
	move	$4,$2
	balc	tolower
	move	$3,$2
	lui	$2,%highest(skip)
	daddiu	$2,$2,%higher(skip)
	dsll	$2,$2,16
	daddiu	$2,$2,%hi(skip)
	dsll	$2,$2,16
	daddiu	$2,$2,%lo(skip)
	dsll	$3,$3,2
	daddu	$2,$3,$2
	li	$3,32767			
	sw	$3,0($2)
	lui	$2,%highest(patlen)
	daddiu	$2,$2,%higher(patlen)
	dsll	$2,$2,16
	daddiu	$2,$2,%hi(patlen)
	dsll	$2,$2,16
	lw	$3,%lo(patlen)($2)
	lui	$2,%highest(skip2)
	daddiu	$2,$2,%higher(skip2)
	dsll	$2,$2,16
	daddiu	$2,$2,%hi(skip2)
	dsll	$2,$2,16
	sw	$3,%lo(skip2)($2)
	sw	$0,0($fp)
	bc	.L9
.L11:
	lui	$2,%highest(pat)
	daddiu	$2,$2,%higher(pat)
	dsll	$2,$2,16
	daddiu	$2,$2,%hi(pat)
	dsll	$2,$2,16
	ld	$3,%lo(pat)($2)
	lw	$2,0($fp)
	daddu	$2,$3,$2
	lbu	$2,0($2)
	move	$3,$2
	lw	$2,4($fp)
	bnec	$2,$3,.L10
	lui	$2,%highest(patlen)
	daddiu	$2,$2,%higher(patlen)
	dsll	$2,$2,16
	daddiu	$2,$2,%hi(patlen)
	dsll	$2,$2,16
	lw	$3,%lo(patlen)($2)
	lw	$2,0($fp)
	subu	$2,$3,$2
	addiu	$2,$2,-1
	move	$3,$2
	lui	$2,%highest(skip2)
	daddiu	$2,$2,%higher(skip2)
	dsll	$2,$2,16
	daddiu	$2,$2,%hi(skip2)
	dsll	$2,$2,16
	sw	$3,%lo(skip2)($2)
.L10:
	lw	$2,0($fp)
	addiu	$2,$2,1
	sw	$2,0($fp)
.L9:
	lui	$2,%highest(patlen)
	daddiu	$2,$2,%higher(patlen)
	dsll	$2,$2,16
	daddiu	$2,$2,%hi(patlen)
	dsll	$2,$2,16
	lw	$2,%lo(patlen)($2)
	addiu	$2,$2,-1
	move	$3,$2
	lw	$2,0($fp)
	bltc	$2,$3,.L11
	nop
	nop
	move	$sp,$fp
	ld	$31,56($sp)
	ld	$fp,48($sp)
	ld	$16,40($sp)
	daddiu	$sp,$sp,64
	jrc	$31
	.globl	bmhi_search
bmhi_search:
	daddiu	$sp,$sp,-48
	sd	$31,40($sp)
	sd	$fp,32($sp)
	move	$fp,$sp
	sd	$4,16($fp)
	move	$2,$5
	sll	$2,$2,0
	sw	$2,24($fp)
	lui	$2,%highest(patlen)
	daddiu	$2,$2,%higher(patlen)
	dsll	$2,$2,16
	daddiu	$2,$2,%hi(patlen)
	dsll	$2,$2,16
	lw	$2,%lo(patlen)($2)
	addiu	$2,$2,-1
	move	$3,$2
	lw	$2,24($fp)
	subu	$2,$3,$2
	sw	$2,0($fp)
	lw	$2,0($fp)
	bltzc	$2,.L13
	move	$2,$0
	bc	.L14
.L13:
	lw	$2,24($fp)
	ld	$3,16($fp)
	daddu	$2,$3,$2
	sd	$2,16($fp)
.L21:
	nop
.L15:
	lw	$2,0($fp)
	ld	$3,16($fp)
	daddu	$2,$3,$2
	lbu	$2,0($2)
	move	$3,$2
	lui	$2,%highest(skip)
	daddiu	$2,$2,%higher(skip)
	dsll	$2,$2,16
	daddiu	$2,$2,%hi(skip)
	dsll	$2,$2,16
	daddiu	$2,$2,%lo(skip)
	dsll	$3,$3,2
	daddu	$2,$3,$2
	lw	$2,0($2)
	lw	$3,0($fp)
	addu	$2,$3,$2
	sw	$2,0($fp)
	lw	$2,0($fp)
	bltzc	$2,.L15
	li	$3,32767			
	lw	$2,24($fp)
	subu	$2,$3,$2
	move	$3,$2
	lw	$2,0($fp)
	bgec	$2,$3,.L16
	move	$2,$0
	bc	.L14
.L16:
	lw	$2,0($fp)
	addiu	$2,$2,-32767
	sw	$2,0($fp)
	lui	$2,%highest(patlen)
	daddiu	$2,$2,%higher(patlen)
	dsll	$2,$2,16
	daddiu	$2,$2,%hi(patlen)
	dsll	$2,$2,16
	lw	$2,%lo(patlen)($2)
	addiu	$2,$2,-1
	sw	$2,4($fp)
	lw	$3,0($fp)
	lw	$2,4($fp)
	subu	$2,$3,$2
	move	$3,$2
	ld	$2,16($fp)
	daddu	$2,$2,$3
	sd	$2,8($fp)
	nop
.L18:
	lw	$2,4($fp)
	addiu	$2,$2,-1
	sw	$2,4($fp)
	lw	$2,4($fp)
	bltzc	$2,.L17
	lw	$2,4($fp)
	ld	$3,8($fp)
	daddu	$2,$3,$2
	lb	$2,0($2)
	move	$4,$2
	balc	toupper
	move	$4,$2
	lui	$2,%highest(pat)
	daddiu	$2,$2,%higher(pat)
	dsll	$2,$2,16
	daddiu	$2,$2,%hi(pat)
	dsll	$2,$2,16
	ld	$3,%lo(pat)($2)
	lw	$2,4($fp)
	daddu	$2,$3,$2
	lbu	$2,0($2)
	beqc	$4,$2,.L18
.L17:
	lw	$2,4($fp)
	bgezc	$2,.L19
	ld	$2,8($fp)
	bc	.L14
.L19:
	lui	$2,%highest(skip2)
	daddiu	$2,$2,%higher(skip2)
	dsll	$2,$2,16
	daddiu	$2,$2,%hi(skip2)
	dsll	$2,$2,16
	lw	$2,%lo(skip2)($2)
	lw	$3,0($fp)
	addu	$2,$3,$2
	sw	$2,0($fp)
	lw	$2,0($fp)
	bltzc	$2,.L21
	move	$2,$0
.L14:
	move	$sp,$fp
	ld	$31,40($sp)
	ld	$fp,32($sp)
	daddiu	$sp,$sp,48
	jrc	$31
	.globl	bhmi_cleanup
bhmi_cleanup:
	daddiu	$sp,$sp,-16
	sd	$31,8($sp)
	sd	$fp,0($sp)
	move	$fp,$sp
	lui	$2,%highest(pat)
	daddiu	$2,$2,%higher(pat)
	dsll	$2,$2,16
	daddiu	$2,$2,%hi(pat)
	dsll	$2,$2,16
	ld	$2,%lo(pat)($2)
	move	$4,$2
	balc	free
	nop
	move	$sp,$fp
	ld	$31,8($sp)
	ld	$fp,0($sp)
	daddiu	$sp,$sp,16
	jrc	$31
